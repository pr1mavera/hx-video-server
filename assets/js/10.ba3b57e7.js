(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{337:function(t,s,a){"use strict";a.r(s);var n=a(3),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录"}},[t._v("#")]),t._v(" 登录")]),t._v(" "),a("h3",{attrs:{id:"腾讯im登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#腾讯im登录"}},[t._v("#")]),t._v(" 腾讯IM登录")]),t._v(" "),a("p",[t._v("通过包装原来的腾讯IM登录接口，添加默认消息接收器 onMsgNotify（可通过参数重写），将来自 webSocket 的远程消息（c2c消息、系统消息）转移至统一的消息事件总线，分离登录逻辑与后续的消息处理逻辑，"),a("code",[t._v("/src/module/im/login.js")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 总线实例索引")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" msgNotifySubjectSub "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 消息订阅并解析，推送至各消息管道")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("msgNotifySubjectInit")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 若初始化过则直接返回之前的subject")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msgNotifySubjectSub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" msgNotifySubjectSub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化subject")]),t._v("\n    msgNotifySubjectSub "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Subject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("flatMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("msg")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseMsgs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此处解析进入的消息")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在内部订阅")]),t._v("\n    msgNotifySubjectSub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("m")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 消息 type$ 类型分流：c2c消息、系统消息、指令消息")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMsgStream$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" msgNotifySubjectSub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 登录 | public\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" login "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listeners "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    options "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'isAccessFormalEnv'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 是否访问正式环境，默认访问正式，选填")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'isLogOn'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 是否开启控制台打印日志，默认开启，选填")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 默认的IM消息解析（可在外部自定义消息解析方式）\n     * 只在login模块内可用\n     */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("_onMsgNotify")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("msgs")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此处直接将拿到的消息推送至总线")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("msgNotifySubjectInit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msgs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" accountInfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用户登录相关参数配置")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用封装好的登录接口")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("IMlogin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("accountInfo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" onMsgNotify"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" _onMsgNotify"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("listeners "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"消息解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息解析"}},[t._v("#")]),t._v(" 消息解析")]),t._v(" "),a("p",[t._v("消息解析的部分逻辑在 "),a("code",[t._v("/src/module/im/parser.js")]),t._v(" 中")]),t._v(" "),a("h3",{attrs:{id:"解析流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解析流程"}},[t._v("#")]),t._v(" 解析流程")]),t._v(" "),a("ol",[a("li",[t._v("根据 "),a("code",[t._v("fromAccount")]),t._v(" 字段获取解析器")]),t._v(" "),a("li",[t._v("分别解析c2c消息和系统消息，并包装对应的 "),a("code",[t._v("type$")]),t._v(" 标明消息类型")]),t._v(" "),a("li",[t._v("根据解析后的消息体分离出指令消息")])]),t._v(" "),a("h3",{attrs:{id:"消息分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息分类"}},[t._v("#")]),t._v(" 消息分类")]),t._v(" "),a("ul",[a("li",[t._v("根据消息体上的 "),a("code",[t._v("fromAccount")]),t._v(" 字段判断是否是系统消息\n"),a("ul",[a("li",[t._v("是系统消息 -> system")]),t._v(" "),a("li",[t._v("不是系统消息，先暂定消息为c2c消息，将消息正常解析，判断解析后消息上的 "),a("code",[t._v("msgType")]),t._v(" 属性判断是否在指令集 "),a("code",[t._v("directiveTypes")]),t._v(" 中\n"),a("ul",[a("li",[t._v("在指令集中 -> directive")]),t._v(" "),a("li",[t._v("不在指令集中 -> C2C")])])])])]),t._v(" "),a("li",[t._v("解析后的消息会带上 "),a("code",[t._v("type$")]),t._v(" 标明消息类型")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指令消息类型")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" directiveTypes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" _msgStreamTypes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'C2C'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Subject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'system'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Subject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'directive'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Subject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"消息发送"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息发送"}},[t._v("#")]),t._v(" 消息发送")]),t._v(" "),a("p",[t._v("消息发送分为「系统消息」和「c2c消息」")]),t._v(" "),a("h3",{attrs:{id:"系统消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统消息"}},[t._v("#")]),t._v(" 系统消息")]),t._v(" "),a("p",[t._v("即简单的包装消息体，通过接口发送至node层，node调用腾讯IM系统消息推送接口，将接口调用返回的 promise 直接return出去")]),t._v(" "),a("h3",{attrs:{id:"c2c消息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#c2c消息"}},[t._v("#")]),t._v(" c2c消息")]),t._v(" "),a("p",[t._v("c2c消息的发送则稍微复杂一些，根据消息类型的不同分离出了不同的API，同时将聊天相关消息发送的回调处理分离，可以方便的在统一的回调函数中，做消息发送失败的业务处理")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * C2C消息总线\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" _msg$ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Subject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 聊天相关消息的发送会将消息推送至 _msg$ 流中，而不是直接的调发送接口")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * C2C消息发送状态通知流，用于处理C2C消息发的成功与失败\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sendMsgsFeedback$ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("combineLatest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_msg$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cs$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCS_$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 过滤掉未注册坐席的异常操作 !!! Side effect !!!")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_isCsRegister")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 过滤掉由坐席状态变更导致的总线通知（拿到的消息的流与上一条时间戳一致，说明不是消息的流更新）")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("distinctUntilChanged")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" p_msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" n_msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" p_msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timestamp "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" n_msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("timestamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 格式化C2C消息体")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_initMsg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webim发送消息")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("flatMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("msgBody")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("IMsendNormalMsg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msgBody"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("catchError")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("消息发送之前会根据不同消息类型做不同的参数规则校验，并且这个参数是灵活可配的")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ./C2C/index.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * C2C消息生成器，方法只将消息体包装成流推送至消息总线，统一发送\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 一系列消息类型 */")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 不同消息类型附带的数据 */")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reduce")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("group"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 其他数据 */")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" formatArgs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("fn_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("args")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 其他数据 */")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("formatArgs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在此处对API调用方传入的参数做校验处理")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 推送至消息总线")]),t._v("\n                _msg$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("group\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ./C2C/methods.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义各个消息发送的默认参数及其传入数据的格式化过程")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sendTextFormatter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    option"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" msgStatus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" msgTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("msg_normal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("formatArgs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("args")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        checkText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检查文本，不可为空，过滤危险字符等等")]),t._v("\n        checkTimestamp "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检查时间戳（此处需要外界传入，因为需要根据此定位消息）")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ./C2C/check.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定义各个参数校验规则")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 校验timestamp\n * @param {Object} args 参数\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("checkTimestamp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("args")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" timestamp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("timestamp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Error in sendMsgs: timestamp is request!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#api"}},[t._v("#")]),t._v(" API")]),t._v(" "),a("p",[t._v("IM模块作为整个SDK通信的核心部分，其API还是比较繁多的")]),t._v(" "),a("h3",{attrs:{id:"登录相关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录相关"}},[t._v("#")]),t._v(" 登录相关")]),t._v(" "),a("h4",{attrs:{id:"login"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#login"}},[t._v("#")]),t._v(" login")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - IM登录")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" config:"),a("code",[t._v("Object")]),t._v(" - 登录配置信息\n"),a("ul",[a("li",[t._v("listeners:"),a("code",[t._v("Object")]),t._v(" - 事件监听器，用于注册IM消息的回调，详细请移步腾讯IM官方文档")]),t._v(" "),a("li",[t._v("options:"),a("code",[t._v("Object")]),t._v(" - 环境配置信息")])])]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("Promise<Object>")])])]),t._v(" "),a("h4",{attrs:{id:"islogin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#islogin"}},[t._v("#")]),t._v(" isLogin")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 判断当前客户端是否是登录状态")]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("Boolean")])])]),t._v(" "),a("h3",{attrs:{id:"c2c消息发送相关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#c2c消息发送相关"}},[t._v("#")]),t._v(" c2c消息发送相关")]),t._v(" "),a("h4",{attrs:{id:"sendmsgsfeedback-observable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sendmsgsfeedback-observable"}},[t._v("#")]),t._v(" sendMsgsFeedback$:Observable")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - C2C消息发送状态流，可用于注册消息发送之后的回调")])]),t._v(" "),a("h4",{attrs:{id:"sendtext"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sendtext"}},[t._v("#")]),t._v(" sendText")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 发送文本")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" args:"),a("code",[t._v("Object")]),t._v(" - 消息参数\n"),a("ul",[a("li",[t._v("content:"),a("code",[t._v("String")]),t._v(" - 文本")]),t._v(" "),a("li",[t._v("timestamp:"),a("code",[t._v("Number")]),t._v(" - 时间戳")])])]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("undefined")])])]),t._v(" "),a("h4",{attrs:{id:"sendimg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sendimg"}},[t._v("#")]),t._v(" sendImg")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 发送图片")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" args:"),a("code",[t._v("Object")]),t._v(" - 消息参数\n"),a("ul",[a("li",[t._v("content?:"),a("code",[t._v("String")]),t._v(" - 图片消息文本（可选）")]),t._v(" "),a("li",[t._v("timestamp:"),a("code",[t._v("Number")]),t._v(" - 时间戳")]),t._v(" "),a("li",[t._v("imgData:"),a("code",[t._v("Object")]),t._v(" - 图片地址等信息")])])]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("undefined")])])]),t._v(" "),a("h4",{attrs:{id:"sendgift"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sendgift"}},[t._v("#")]),t._v(" sendGift")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 发送礼物")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" args:"),a("code",[t._v("Object")]),t._v(" - 消息参数\n"),a("ul",[a("li",[t._v("content?:"),a("code",[t._v("String")]),t._v(" - 礼物消息文本（可选）")]),t._v(" "),a("li",[t._v("timestamp:"),a("code",[t._v("Number")]),t._v(" - 时间戳")]),t._v(" "),a("li",[t._v("giftData:"),a("code",[t._v("Object")]),t._v(" - 礼物id等信息")])])]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("undefined")])])]),t._v(" "),a("h4",{attrs:{id:"sendxhexpression"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sendxhexpression"}},[t._v("#")]),t._v(" sendXHExpression")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 发送表情")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" args:"),a("code",[t._v("Object")]),t._v(" - 消息参数\n"),a("ul",[a("li",[t._v("content?:"),a("code",[t._v("String")]),t._v(" - 表情消息文本（可选）")]),t._v(" "),a("li",[t._v("timestamp:"),a("code",[t._v("Number")]),t._v(" - 时间戳")]),t._v(" "),a("li",[t._v("giftData:"),a("code",[t._v("Object")]),t._v(" - 表情id等信息")])])]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("undefined")])])]),t._v(" "),a("h4",{attrs:{id:"sendlike"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sendlike"}},[t._v("#")]),t._v(" sendLike")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 发送点赞消息")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" args:"),a("code",[t._v("Object")]),t._v(" - 消息参数\n"),a("ul",[a("li",[t._v("content?:"),a("code",[t._v("String")]),t._v(" - 点赞消息文本（可选）")]),t._v(" "),a("li",[t._v("timestamp:"),a("code",[t._v("Number")]),t._v(" - 时间戳")])])]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("Promise<Object>")])])]),t._v(" "),a("h4",{attrs:{id:"sendassess"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sendassess"}},[t._v("#")]),t._v(" sendAssess")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 发送评价消息")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" args:"),a("code",[t._v("Object")]),t._v(" - 消息参数\n"),a("ul",[a("li",[t._v("content?:"),a("code",[t._v("String")]),t._v(" - 评价消息文本（可选）")]),t._v(" "),a("li",[t._v("timestamp:"),a("code",[t._v("Number")]),t._v(" - 时间戳")]),t._v(" "),a("li",[t._v("assessData:"),a("code",[t._v("Object")]),t._v(" - 评价信息")])])]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("Promise<Object>")])])]),t._v(" "),a("h4",{attrs:{id:"senddirective"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#senddirective"}},[t._v("#")]),t._v(" sendDirective")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 发送特定类型的指令消息")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" args:"),a("code",[t._v("Object")]),t._v(" - 消息参数\n"),a("ul",[a("li",[t._v("content?:"),a("code",[t._v("String")]),t._v(" - 消息文本（可选）")]),t._v(" "),a("li",[t._v("timestamp:"),a("code",[t._v("Number")]),t._v(" - 时间戳")]),t._v(" "),a("li",[t._v("msgType:"),a("code",[t._v("String")]),t._v(" - 消息类型编码")])])]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("Promise<Object>")])])]),t._v(" "),a("h3",{attrs:{id:"系统消息推送相关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统消息推送相关"}},[t._v("#")]),t._v(" 系统消息推送相关")]),t._v(" "),a("h4",{attrs:{id:"systemmsgctor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#systemmsgctor"}},[t._v("#")]),t._v(" systemMsgCtor")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 系统消息推送消息体构造器")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" code:"),a("code",[t._v("Number")]),t._v(" - 系统消息编码")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" target:"),a("code",[t._v("Object")]),t._v(" - 推送目标的信息，包含csId、csNick等")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" ext:"),a("code",[t._v("Object")]),t._v(" - 额外的信息，将会被包装在 "),a("code",[t._v("msgBody.data")]),t._v(" 上，会覆盖")]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("Object")])])]),t._v(" "),a("h4",{attrs:{id:"pushmsgto"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pushmsgto"}},[t._v("#")]),t._v(" pushMsgTo")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 构造系统消息推送至指定用户")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" code:"),a("code",[t._v("Number")]),t._v(" - 系统消息编码")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" target:"),a("code",[t._v("Object")]),t._v(" - 推送目标的信息，包含csId、csNick等")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" ext:"),a("code",[t._v("Object")]),t._v(" - 额外的信息，将会被包装在 "),a("code",[t._v("msgBody.data")]),t._v(" 上，会覆盖")]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("Promise<Object>")])])]),t._v(" "),a("h4",{attrs:{id:"pushmsg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pushmsg"}},[t._v("#")]),t._v(" pushMsg")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 推送系统消息至当前sdk内部注册的坐席对象")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" code:"),a("code",[t._v("Number")]),t._v(" - 系统消息编码")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" ext:"),a("code",[t._v("Object")]),t._v(" - 额外的信息，将会被包装在 "),a("code",[t._v("msgBody.data")]),t._v(" 上，会覆盖")]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("Promise<Object>")])])]),t._v(" "),a("h3",{attrs:{id:"消息接收相关"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息接收相关"}},[t._v("#")]),t._v(" 消息接收相关")]),t._v(" "),a("h4",{attrs:{id:"parsemsgs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#parsemsgs"}},[t._v("#")]),t._v(" parseMsgs")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 解析IM消息体")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" IMMsgs:"),a("code",[t._v("MsgElm")]),t._v(" - 腾讯IM，onMsgNotify接口回调中拿到的消息体")]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("Observable<Object>")])])]),t._v(" "),a("h4",{attrs:{id:"getmsgstream"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#getmsgstream"}},[t._v("#")]),t._v(" getMsgStream$")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 获取消息监听的可观测对象")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" event:"),a("code",[t._v("'C2C' | 'system' | 'directive'")]),t._v(" - 消息类型")]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("Subject")])])]),t._v(" "),a("h4",{attrs:{id:"onmsg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onmsg"}},[t._v("#")]),t._v(" onMsg")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 添加消息监听")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" event:"),a("code",[t._v("'C2C' | 'system' | 'directive'")]),t._v(" - 消息类型")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" next:"),a("code",[t._v("Function")]),t._v(" - 消息成功接收时的回调")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" error?:"),a("code",[t._v("Function")]),t._v(" - 消息接收失败时的回调（可选，此处一般是消息解析过程中的错误，可在开发阶段重点关注解析过程）")]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("Subscription")]),t._v(" 可用于注销消息监听")])]),t._v(" "),a("h3",{attrs:{id:"其他"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[t._v("#")]),t._v(" 其他")]),t._v(" "),a("h4",{attrs:{id:"getuserinfo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#getuserinfo"}},[t._v("#")]),t._v(" getUserInfo")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 获取初始化SDK时注册的用户信息")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" - 无")]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - "),a("code",[t._v("Object")])])]),t._v(" "),a("h4",{attrs:{id:"uploadimgs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#uploadimgs"}},[t._v("#")]),t._v(" uploadImgs")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("@desc")]),t._v(" - 上传照片至腾讯服务器")]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" option:"),a("code",[t._v("Object")]),t._v(" - 图片相关数据\n"),a("ul",[a("li",[t._v("files:"),a("code",[t._v("Object")]),t._v(" - 图片本机路径和大小")]),t._v(" "),a("li",[t._v("calcFileInfo:"),a("code",[t._v("Function")]),t._v(" - 用于解析图片成base64和buffer（小程序API）")])])]),t._v(" "),a("li",[a("code",[t._v("@param")]),t._v(" to:"),a("code",[t._v("String")]),t._v(" - 图片上传之后的接收者")]),t._v(" "),a("li",[a("code",[t._v("@return")]),t._v(" - BehaviorSubject")])])])},[],!1,null,null,null);s.default=e.exports}}]);